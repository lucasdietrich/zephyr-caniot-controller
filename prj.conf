# https://docs.zephyrproject.org/latest/reference/kconfig/index-all.html

# -----------------------------------------------------------------------------

# GENERAL

# fs function needs a lot of stack/ram in general
CONFIG_MAIN_STACK_SIZE=2048

# https://docs.zephyrproject.org/latest/reference/kernel/threads/workqueue.html#configuration-options
CONFIG_SYSTEM_WORKQUEUE_STACK_SIZE=2024
CONFIG_SYSTEM_WORKQUEUE_PRIORITY=-1
CONFIG_SYSTEM_WORKQUEUE_NO_YIELD=n

CONFIG_INIT_STACKS=y

CONFIG_TIMEOUT_64BIT=y

CONFIG_POSIX_API=y
# CONFIG_MINIMAL_LIBC=y
# CONFIG_MINIMAL_LIBC_MALLOC=y
# CONFIG_MINIMAL_LIBC_MALLOC_ARENA_SIZE=1024
CONFIG_NEWLIB_LIBC=y
CONFIG_NEWLIB_LIBC_FLOAT_PRINTF=y
CONFIG_NEWLIB_LIBC_FLOAT_SCANF=y

CONFIG_HEAP_MEM_POOL_SIZE=0

CONFIG_POLL=y

# -----------------------------------------------------------------------------

# LOGGING
# https://docs.zephyrproject.org/latest/reference/logging/index.html
CONFIG_LOG=y
CONFIG_PRINTK=y

# CONFIG_CONSOLE=y
# CONFIG_UART_CONSOLE=y
# CONFIG_STDOUT_CONSOLE=y

CONFIG_CBPRINTF_FP_SUPPORT=y

# -----------------------------------------------------------------------------

# DEBUG
CONFIG_ASSERT=n
# CONFIG_ASSERT_ON_ERRORS=y
# CONFIG_NO_RUNTIME_CHECKS=n
CONFIG_RUNTIME_ERROR_CHECKS=y


CONFIG_THREAD_MONITOR=n

# https://docs.zephyrproject.org/latest/guides/flash_debug/thread-analyzer.html
# -> disable CONFIG_LOG_MODE_IMMEDIATE when using THREAD analyser
CONFIG_THREAD_NAME=y
CONFIG_THREAD_ANALYZER=n            
# CONFIG_THREAD_ANALYZER_USE_PRINTK=n
# CONFIG_THREAD_ANALYZER_USE_LOG=y
# CONFIG_THREAD_ANALYZER_AUTO=y
# CONFIG_THREAD_ANALYZER_AUTO_INTERVAL=10
# THREAD_ANALYZER_AUTO_STACK_SIZE
CONFIG_THREAD_RUNTIME_STATS=y

# -----------------------------------------------------------------------------

CONFIG_NETWORKING=y
CONFIG_NET_UDP=y
CONFIG_NET_TCP=y

CONFIG_NET_IPV4=y
CONFIG_NET_IPV6=y
CONFIG_NET_TCP=y
CONFIG_NET_ARP=y
CONFIG_NET_UDP=y

CONFIG_NET_STATISTICS=y
CONFIG_NET_STATISTICS_USER_API=y
CONFIG_NET_STATISTICS_IPV4=y
CONFIG_NET_STATISTICS_ICMP=y
CONFIG_NET_STATISTICS_TCP=y
CONFIG_NET_STATISTICS_UDP=y

CONFIG_NET_CONNECTION_MANAGER=n

# TO DEBUG
# CONFIG_NET_DRIVERS=y
# CONFIG_NET_LOOPBACK=y
# CONFIG_NET_LOOPBACK_LOG_LEVEL_DBG=y
# CONFIG_NET_IF_MAX_IPV4_COUNT=2

CONFIG_NET_MGMT=y
CONFIG_NET_MGMT_EVENT=y

CONFIG_NET_SOCKETS=y

CONFIG_NET_SOCKETS_SOCKOPT_TLS=y
CONFIG_NET_SOCKETS_TLS_MAX_CONTEXTS=4

# https://github.com/zephyrproject-rtos/zephyr/issues/39705
# incompatible with CONFIG_POSIX_API option
# CONFIG_NET_SOCKETS_POSIX_NAMES=y

CONFIG_NET_BUF_DATA_SIZE=128
# default 36
CONFIG_NET_PKT_RX_COUNT=64
CONFIG_NET_PKT_TX_COUNT=64
CONFIG_NET_BUF_RX_COUNT=64
CONFIG_NET_BUF_TX_COUNT=64

CONFIG_DNS_RESOLVER=y
CONFIG_DNS_RESOLVER_ADDITIONAL_BUF_CTR=1
CONFIG_DNS_RESOLVER_ADDITIONAL_QUERIES=1
CONFIG_DNS_RESOLVER_AI_MAX_ENTRIES=1

CONFIG_DNS_RESOLVER_MAX_SERVERS=1
# https://docs.zephyrproject.org/latest/reference/kconfig/CONFIG_DNS_SERVER1.html#std-kconfig-CONFIG_DNS_SERVER1
# SET CONFIG_DNS_RESOLVER_MAX_SERVERS to 2 if enabling next configuration option
# CONFIG_DNS_SERVER2="192.168.10.6"

CONFIG_DNS_RESOLVER_LOG_LEVEL_DBG=y

# CONFIG_MDNS_RESOLVER=y
# CONFIG_LLMNR_RESOLVER=n
# CONFIG_DNS_RESOLVER_MAX_SERVERS=2
# CONFIG_DNS_SERVER_IP_ADDRESSES=y
# CONFIG_DNS_NUM_CONCUR_QUERIES=5

# Config SNTP
CONFIG_SNTP=y
CONFIG_SNTP_LOG_LEVEL_DBG=n

CONFIG_NET_LOG=y
# IMPORTANT - CONFIG_NET_SOCKETS_LOG_LEVEL_DBG should also be enabled when debugging MBEDTLS stack
CONFIG_NET_SOCKETS_LOG_LEVEL_DBG=n
CONFIG_NET_IF_LOG_LEVEL_INF=y
CONFIG_NET_TCP_LOG_LEVEL_DBG=n
CONFIG_NET_CONFIG_LOG_LEVEL_DBG=n
CONFIG_NET_L2_ETHERNET_LOG_LEVEL_INF=n
CONFIG_NET_CORE_LOG_LEVEL_DBG=n
CONFIG_NET_CONN_LOG_LEVEL_DBG=n

CONFIG_NET_CONFIG_SETTINGS=n
CONFIG_NET_CONFIG_AUTO_INIT=n
CONFIG_NET_CONFIG_CLOCK_SNTP_INIT=n
CONFIG_NET_CONFIG_NEED_IPV6=n
CONFIG_NET_CONFIG_NEED_IPV4=n

CONFIG_NET_MAX_CONN=12
CONFIG_NET_MAX_CONTEXTS=12
CONFIG_POSIX_MAX_FDS=16
CONFIG_NET_SOCKETS_POLL_MAX=7

# https://docs.zephyrproject.org/latest/reference/kconfig/CONFIG_NET_TCP_TIME_WAIT_DELAY.html#std-kconfig-CONFIG_NET_TCP_TIME_WAIT_DELAY
# free TCP context immediately when closed
CONFIG_NET_TCP_TIME_WAIT_DELAY=0

# https://docs.zephyrproject.org/latest/reference/kconfig/CONFIG_NET_TCP_BACKLOG_SIZE.html#std-kconfig-CONFIG_NET_TCP_BACKLOG_SIZE
# CONFIG_NET_TCP_BACKLOG_SIZE=5

# -----------------------------------------------------------------------------

CONFIG_MBEDTLS_BUILTIN=y

# we disable heap as we will allocate it manually in CCM Pusing mbedtls_memory_buffer_alloc_init
CONFIG_MBEDTLS_ENABLE_HEAP=n
# CONFIG_MBEDTLS_HEAP_SIZE=65536

CONFIG_MBEDTLS_SSL_MAX_CONTENT_LEN=4096
CONFIG_NET_SOCKETS_TLS_SET_MAX_FRAGMENT_LENGTH=y

CONFIG_MBEDTLS_CFG_FILE="config-tls-generic.h"
CONFIG_MBEDTLS_USER_CONFIG_ENABLE=y
CONFIG_MBEDTLS_USER_CONFIG_FILE="mbedtls-cfg.h"

CONFIG_MBEDTLS_CIPHER=y

# CONFIG_MBEDTLS_MAC_ALL_ENABLED=y
CONFIG_MBEDTLS_MAC_MD5_ENABLED=y
CONFIG_MBEDTLS_MAC_SHA1_ENABLED=y
CONFIG_MBEDTLS_MAC_SHA256_ENABLED=y
CONFIG_MBEDTLS_MAC_SHA512_ENABLED=y

# CONFIG_MBEDTLS_CIPHER_ALL_ENABLED=y
# CONFIG_MBEDTLS_CIPHER_AES_ENABLED=y
CONFIG_MBEDTLS_CIPHER_MODE_CBC_ENABLED=y

# CONFIG_MBEDTLS_KEY_EXCHANGE_ALL_ENABLED=y
# CONFIG_MBEDTLS_KEY_EXCHANGE_ECDHE_RSA_ENABLED=y
# CONFIG_MBEDTLS_KEY_EXCHANGE_ECDH_RSA_ENABLED=y
CONFIG_MBEDTLS_KEY_EXCHANGE_RSA_ENABLED=y

# CONFIG_MBEDTLS_ECP_ALL_ENABLED=y

# TODO set to off later
CONFIG_MBEDTLS_PEM_CERTIFICATE_FORMAT=y

### ???
# CONFIG_CRYPTO=y

### ???
CONFIG_ENTROPY_GENERATOR=y
CONFIG_TEST_RANDOM_GENERATOR=n
# don't use test random generator in production

# CONFIG_MBEDTLS_ENTROPY_ENABLED=y

CONFIG_MBEDTLS_TLS_VERSION_1_2=y
CONFIG_MBEDTLS_TLS_VERSION_1_1=n
CONFIG_MBEDTLS_TLS_VERSION_1_0=n

# Debug
CONFIG_MBEDTLS_DEBUG=y
CONFIG_MBEDTLS_DEBUG_LEVEL=1
CONFIG_MBEDTLS_MEMORY_DEBUG=y

# -----------------------------------------------------------------------------

CONFIG_BOOTLOADER_MCUBOOT=n

# -----------------------------------------------------------------------------

CONFIG_MPU_ALLOW_FLASH_WRITE=y

CONFIG_FLASH=y
CONFIG_FLASH_MAP=y
CONFIG_FLASH_PAGE_LAYOUT=y

CONFIG_NVS=y
CONFIG_NVS_LOG_LEVEL_DBG=y

CONFIG_FILE_SYSTEM=y
CONFIG_FILE_SYSTEM_MAX_TYPES=1

CONFIG_DISK_ACCESS=y
CONFIG_DISK_LOG_LEVEL_DBG=y

CONFIG_FAT_FILESYSTEM_ELM=y
CONFIG_FS_FATFS_EXFAT=y
CONFIG_FS_LOG_LEVEL_INF=y

# -----------------------------------------------------------------------------

CONFIG_EVENTFD=y
CONFIG_EVENTFD_MAX=1

# -----------------------------------------------------------------------------

CONFIG_HTTP_CLIENT=y
CONFIG_HTTP_PARSER=y
CONFIG_JSON_LIBRARY=y

# -----------------------------------------------------------------------------

CONFIG_SYS_MEM_BLOCKS=y

# -----------------------------------------------------------------------------

# CONFIG_PICOLIBC_MODULE=y

# -----------------------------------------------------------------------------

CONFIG_LUA=y